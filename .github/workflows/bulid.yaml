name: Build Node Pipeline

on: push

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Check out
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Checking node version
        run:
          node --version
          npm --version
      
      - name: Install Dependencies
        run: npm install

      - name: Run Test Cases
        run: npm test

  docker-build-test:
    runs-on: ubuntu-latest
    needs: build-and-test 

    steps:
      - name: Check out
        uses: actions/checkout@v4

      - name: Build docker image
        run: docker build -t student-managment-api-v1-image:test .
      
      - name: Run container with image
        run: |
          docker run -d -p 3000:3000 --name student-managment-api-v1 student-managment-api-v1-image:test
          sleep 10

      - name: Check the container
        run: docker container ls
